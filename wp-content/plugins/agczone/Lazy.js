var LazyLoad=new Class({Implements:[Options,Events],options:{range:300,elements:"img",container:window,mode:"vertical",realSrcAttribute:"data-src",useFade:true},initialize:function(options){this.setOptions(options);this.container=document.id(this.options.container);this.elements=$$(this.options.elements);this.largestPosition=0;var axis=(this.options.mode=="vertical"?"y":"x");var offset=(this.container!=window&&this.container!=document.body?this.container:"");this.elements=this.elements.filter(function(el){if(this.options.useFade)el.setStyle("opacity",0);var elPos=el.getPosition(offset)[axis];if(elPos<this.container.getSize()[axis]+this.options.range){this.loadImage(el);return false;}
return true;},this);var action=function(e){var cpos=this.container.getScroll()[axis];if(cpos>this.largestPosition){this.elements=this.elements.filter(function(el){if((cpos+this.options.range+this.container.getSize()[axis])>=el.getPosition(offset)[axis]){this.loadImage(el);return false;}
return true;},this);this.largestPosition=cpos;}
this.fireEvent("scroll");if(!this.elements.length){this.container.removeEvent("scroll",action);this.fireEvent("complete");}}.bind(this);this.container.addEvent("scroll",action);},loadImage:function(image){if(this.options.useFade){image.addEvent("load",function(){image.fade(1);});}
image.set("src",image.get(this.options.realSrcAttribute));this.fireEvent("load",[image]);}});window.addEvent("domready",function(){var lazyloader=new LazyLoad({});});